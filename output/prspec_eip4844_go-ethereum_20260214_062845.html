<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EIP-4844 Compliance Report - go-ethereum</title>
    <style>
        *, *::before, *::after { box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; background: #f0f2f5; color: #1a1a2e; line-height: 1.6; }
        .page { max-width: 960px; margin: 40px auto; padding: 0 20px; }
        header { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); color: #fff; padding: 36px 40px; border-radius: 12px 12px 0 0; }
        header h1 { margin: 0 0 6px; font-size: 1.6em; font-weight: 700; }
        header .meta { font-size: 0.85em; opacity: 0.8; }
        .body { background: #fff; padding: 32px 40px; border-radius: 0 0 12px 12px; box-shadow: 0 4px 24px rgba(0,0,0,0.06); }
        .kpi-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 16px; margin-bottom: 32px; }
        .kpi { background: #f8f9fb; border: 1px solid #e8eaed; border-radius: 8px; padding: 18px 14px; text-align: center; }
        .kpi .num { font-size: 1.7em; font-weight: 700; }
        .kpi .lbl { font-size: 0.78em; color: #666; text-transform: uppercase; letter-spacing: 0.5px; margin-top: 4px; }
        h2 { font-size: 1.15em; font-weight: 600; color: #333; border-bottom: 2px solid #e8eaed; padding-bottom: 8px; margin: 28px 0 18px; }
        .file-card { border: 1px solid #e0e3e8; border-radius: 8px; margin-bottom: 20px; overflow: hidden; }
        .file-card .head { display: flex; justify-content: space-between; align-items: center; padding: 12px 18px; background: #fafbfc; border-bottom: 1px solid #e0e3e8; }
        .file-card .head .path { font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', monospace; font-size: 0.88em; font-weight: 500; }
        .badge { display: inline-block; padding: 3px 12px; border-radius: 12px; color: #fff; font-size: 0.75em; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; }
        .file-card .content { padding: 16px 18px; }
        .file-card .content p { margin: 0 0 10px; }
        .issue { border-left: 3px solid; padding: 12px 16px; margin: 12px 0; border-radius: 0 6px 6px 0; background: #fafbfc; }
        .issue-high { border-color: #e03e3e; background: #fef2f2; }
        .issue-medium { border-color: #d4a017; background: #fffbeb; }
        .issue-low { border-color: #2e7d32; background: #f0fdf4; }
        .issue .title { font-weight: 600; margin-bottom: 6px; font-size: 0.92em; }
        .issue .detail { font-size: 0.85em; color: #555; margin: 3px 0; }
        .issue .detail strong { color: #333; }
        code { background: #eef0f4; padding: 1px 5px; border-radius: 3px; font-family: 'SFMono-Regular', Consolas, monospace; font-size: 0.88em; }
        .footer { text-align: center; padding: 24px 0 0; margin-top: 32px; border-top: 1px solid #e8eaed; font-size: 0.8em; color: #888; }
    </style>
</head>
<body>
<div class="page">
    <header>
        <h1>EIP-4844 Compliance Report - go-ethereum</h1>
        <div class="meta">2026-02-14 06:28 &middot; Gemini (gemini-2.5-pro) &middot; v1.1.0</div>
    </header>
    <div class="body">
        <div class="kpi-row">
            <div class="kpi"><div class="num">ISSUES FOUND</div><div class="lbl">Status</div></div>
            <div class="kpi"><div class="num">96%</div><div class="lbl">Confidence</div></div>
            <div class="kpi"><div class="num">5</div><div class="lbl">Files</div></div>
            <div class="kpi"><div class="num" style="color:#e03e3e">4</div><div class="lbl">High</div></div>
            <div class="kpi"><div class="num" style="color:#d4a017">0</div><div class="lbl">Medium</div></div>
            <div class="kpi"><div class="num" style="color:#2e7d32">3</div><div class="lbl">Low</div></div>
        </div>
        
        <div style="background:#f8f9fb;border:1px solid #e8eaed;border-radius:8px;padding:18px 22px;margin-bottom:28px;font-size:0.93em;line-height:1.7;white-space:pre-line;">PRSpec analysed 5 files from go-ethereum's EIP-4844 implementation using Gemini (gemini-2.5-pro). Overall verdict: ISSUES FOUND at 96% average confidence. 7 issues detected (4 high, 3 low).

consensus/misc/eip4844/eip4844.go — PARTIAL_MATCH (1 issues): The provided Go code correctly implements the EIP-4844 header validation and fee market mechanics within its scope. The 
core/types/tx_blob.go — PARTIAL_MATCH (1 issues): The provided code correctly implements the EIP-4844 blob transaction data structure, its fields, signing hash, and canon
crypto/kzg4844/kzg4844.go — PARTIAL_MATCH (1 issues): The provided Go code correctly implements the basic data structures (Blob, Commitment, Proof) and function signatures re
params/protocol_params.go — PARTIAL_MATCH (3 issues): The provided code, `params/protocol_params.go`, correctly implements the EIP-4844 constants that it defines. However, th
core/txpool/legacypool/legacypool.go — MISSING (1 issues): The provided code from `legacypool.go` does not implement EIP-4844. It is designed as a pool for pre-Cancun transaction </div>

        <h2>Findings</h2>

        <div class="file-card">
            <div class="head">
                <span class="path">consensus/misc/eip4844/eip4844.go</span>
                <span class="badge" style="background:#ffc107">PARTIAL_MATCH</span>
            </div>
            <div class="content">
                <p><strong>Confidence:</strong> 95%</p>
                <p>The provided Go code correctly implements the EIP-4844 header validation and fee market mechanics within its scope. The implementation of the `fake_exponential` and the base `calc_excess_blob_gas` functions are fully compliant with the specification. The code is considered a partial match because it only covers a subset of the EIP (header/fee logic) and includes a minor, but intentional, deviation to support a future hard fork, which is properly fork-gated.</p>

                <div class="issue issue-low">
                    <div class="title">[LOW] DEVIATION</div>
                    <div class="detail"><strong>Description:</strong> The implementation of `calcExcessBlobGas` includes logic for a future hard fork (Osaka, EIP-7918) that is not part of the EIP-4844 specification. The EIP-4844 spec defines a single, unconditional formula for calculating excess blob gas. The Go implementation contains a conditional block gated by `isOsaka` that introduces an alternative calculation when a 'reserve price' condition is met.</div>
                    <div class="detail"><strong>Spec ref:</strong> <code>def calc_excess_blob_gas(parent: Header) -> int:
    if parent.excess_blob_gas + parent.blob_gas_used < TARGET_BLOB_GAS_PER_BLOCK:
        return 0
    else:
        return parent.excess_blob_gas + parent.blob_gas_used - TARGET_BLOB_GAS_PER_BLOCK</code></div>
                    <div class="detail"><strong>Location:</strong> <code>calcExcessBlobGas</code></div>
                    <div class="detail"><strong>Impact:</strong> This deviation does not pose a risk to networks running the Cancun hard fork (where EIP-4844 is activated) because the additional logic is correctly gated by a fork check. However, it is a deviation from the provided EIP-4844 specification. An error in the fork-gating logic could potentially lead to a consensus failure when the future fork activates.</div>
                    <div class="detail"><strong>Fix:</strong> No change is required. This implementation pattern is standard practice in Ethereum clients to maintain forward compatibility with upcoming network upgrades. The finding is informational, highlighting that the code base implements more than the strict EIP-4844 specification.</div>
                </div>

            </div>
        </div>

        <div class="file-card">
            <div class="head">
                <span class="path">core/types/tx_blob.go</span>
                <span class="badge" style="background:#ffc107">PARTIAL_MATCH</span>
            </div>
            <div class="content">
                <p><strong>Confidence:</strong> 95%</p>
                <p>The provided code correctly implements the EIP-4844 blob transaction data structure, its fields, signing hash, and canonical RLP encoding. It deviates slightly from the specification by introducing a versioned network format for the transaction sidecar, which is a non-breaking extension for forward compatibility. Key EIP-4844 logic such as block validation rules, gas pricing mechanics, and the point evaluation precompile are not within the scope of this file and thus were not reviewed.</p>

                <div class="issue issue-low">
                    <div class="title">[LOW] DEVIATION</div>
                    <div class="detail"><strong>Description:</strong> The implementation supports the networking format for blob transactions with sidecars as specified in EIP-4844. However, it also introduces a versioned networking format that is not part of the specification. The code defines and handles a `V0` format (`blobTxWithBlobsV0`) that matches the spec's `rlp([tx_payload_body, blobs, commitments, proofs])` and a `V1` format (`blobTxWithBlobsV1`) that prepends a version byte to the sidecar data, resulting in `rlp([tx_payload_body, version, blobs, commitments, proofs])`. The `decode` function is able to parse both formats, ensuring backward compatibility.</div>
                    <div class="detail"><strong>Spec ref:</strong> <code>Blob transactions have two network representations. During transaction gossip responses (`PooledTransactions`), the EIP-2718 `TransactionPayload` of the blob transaction is wrapped to become:

```
rlp([tx_payload_body, blobs, commitments, proofs])
```</code></div>
                    <div class="detail"><strong>Location:</strong> <code>struct blobTxWithBlobsV1, encode function, decode function</code></div>
                    <div class="detail"><strong>Impact:</strong> This deviation is a non-breaking extension designed for forward compatibility (e.g., for Data Availability Sampling proofs). However, since it's not in the final EIP, it could lead to minor interoperability issues if other clients or tools implement only the specified format and are not aware of this versioned extension used by go-ethereum. It does not pose a direct security or consensus risk.</div>
                    <div class="detail"><strong>Fix:</strong> To ensure full specification alignment across all clients, this versioning scheme should be formally specified, perhaps through a new EIP or an update to EIP-4844. This would clarify the standard for all implementers. The implementation itself is robust and the versioning is a good engineering practice for future upgrades.</div>
                </div>

            </div>
        </div>

        <div class="file-card">
            <div class="head">
                <span class="path">crypto/kzg4844/kzg4844.go</span>
                <span class="badge" style="background:#ffc107">PARTIAL_MATCH</span>
            </div>
            <div class="content">
                <p><strong>Confidence:</strong> 95%</p>
                <p>The provided Go code correctly implements the basic data structures (Blob, Commitment, Proof) and function signatures required for EIP-4844's cryptographic operations, such as versioned hash calculation. However, it does not contain the explicit validation logic for cryptographic inputs (commitments, proofs, and field elements) that is mandated by the specification. This critical validation is presumably delegated to backend libraries, but its absence from the provided code represents a significant compliance gap, as the security of the system relies on these checks being performed correctly.</p>

                <div class="issue issue-high">
                    <div class="title">[HIGH] MISSING_CHECK</div>
                    <div class="detail"><strong>Description:</strong> The specification requires strict validation for cryptographic inputs. Specifically, `KZGCommitment` and `KZGProof` types must be validated as valid G1 points (on the curve, in the correct subgroup, allowing the identity point). Additionally, field elements used in the point evaluation precompile (`z` and `y`) must be canonical (i.e., less than `BLS_MODULUS`). The provided Go code in `kzg4844.go` defines the types and function wrappers (e.g., `VerifyProof`) but does not perform these validation checks itself. The validation is delegated to unprovided backend implementations (`gokzg...` and `ckzg...`). While this is a common pattern, the wrapper code lacks explicit confirmation or documentation that these critical checks are performed by the backends, making the provided code's compliance with the specification uncertain and incomplete on its own.</div>
                    <div class="detail"><strong>Spec ref:</strong> <code>Type aliases | KZGCommitment | Perform IETF BLS signature "KeyValidate" check but do allow the identity point
Type aliases | KZGProof | Same as for KZGCommitment
Point evaluation precompile | The precompile MUST reject non-canonical field elements (i.e. provided field elements MUST be strictly less than BLS_MODULUS).</code></div>
                    <div class="detail"><strong>Location:</strong> <code>VerifyProof, VerifyBlobProof</code></div>
                    <div class="detail"><strong>Impact:</strong> If the underlying backend implementations fail to perform these validations, it could lead to severe security vulnerabilities or consensus failures. Accepting invalid commitments or proofs could break the security assumptions of the KZG scheme, potentially allowing an attacker to forge proofs for invalid data. Accepting non-canonical field elements in the precompile could lead to consensus splits if different client implementations interpret the values differently. This would undermine the integrity of the entire EIP-4844 data availability system.</div>
                    <div class="detail"><strong>Fix:</strong> The wrapper functions in `kzg4844.go` should be updated to either: 1) Explicitly perform the required validation checks on all cryptographic inputs before passing them to the backend functions. 2) Include explicit documentation (e.g., comments) confirming that the backend implementations are fully compliant with the EIP-4844 specification, including all required validation of commitments, proofs, and field elements. This would make the code's compliance verifiable and robust.</div>
                </div>

            </div>
        </div>

        <div class="file-card">
            <div class="head">
                <span class="path">params/protocol_params.go</span>
                <span class="badge" style="background:#ffc107">PARTIAL_MATCH</span>
            </div>
            <div class="content">
                <p><strong>Confidence:</strong> 95%</p>
                <p>The provided code, `params/protocol_params.go`, correctly implements the EIP-4844 constants that it defines. However, the file is critically incomplete, missing numerous required parameters for the fee market, transaction type, and new opcode, which constitutes a significant deviation. Additionally, it introduces a non-specified constant, `BlobBaseCost`, for intrinsic gas calculation that could pose a cross-client compatibility risk.</p>

                <div class="issue issue-high">
                    <div class="title">[HIGH] DEVIATION</div>
                    <div class="detail"><strong>Description:</strong> The implementation file `params/protocol_params.go`, which defines protocol-wide constants, is missing the definitions for `TARGET_BLOB_GAS_PER_BLOCK` and `BLOB_BASE_FEE_UPDATE_FRACTION`. These constants are essential for the blob gas fee update mechanism, specifically for calculating the `excess_blob_gas` and the `base_fee_per_blob_gas`.</div>
                    <div class="detail"><strong>Spec ref:</strong> <code>| Constant | Value |
| - | - |
| `TARGET_BLOB_GAS_PER_BLOCK` | `393216` |
| `BLOB_BASE_FEE_UPDATE_FRACTION` | `3338477` |</code></div>
                    <div class="detail"><strong>Location:</strong> <code>params/protocol_params.go</code></div>
                    <div class="detail"><strong>Impact:</strong> If these critical constants are not defined or are defined incorrectly elsewhere in the codebase, it would lead to an incorrect implementation of the blob gas price update rule. This would break the fee market mechanism and cause a consensus failure between clients that have different values.</div>
                    <div class="detail"><strong>Fix:</strong> Add the constants `TargetBlobGasPerBlock = 393216` and `BlobBaseFeeUpdateFraction = 3338477` to the `params/protocol_params.go` file to ensure they are centrally defined and correctly used throughout the client implementation.</div>
                </div>

                <div class="issue issue-high">
                    <div class="title">[HIGH] DEVIATION</div>
                    <div class="detail"><strong>Description:</strong> The implementation file is missing several critical identifiers and parameters required by EIP-4844. Specifically, `BLOB_TX_TYPE`, `VERSIONED_HASH_VERSION_KZG`, `POINT_EVALUATION_PRECOMPILE_ADDRESS`, `HASH_OPCODE_BYTE` (for the BLOBHASH opcode), and `HASH_OPCODE_GAS` are not defined in this central parameters file.</div>
                    <div class="detail"><strong>Spec ref:</strong> <code>| Constant | Value |
| - | - |
| `BLOB_TX_TYPE` | `Bytes1(0x03)` |
| `VERSIONED_HASH_VERSION_KZG` | `Bytes1(0x01)` |
| `POINT_EVALUATION_PRECOMPILE_ADDRESS` | `Bytes20(0x0A)` |
| `HASH_OPCODE_BYTE` | `Bytes1(0x49)` |
| `HASH_OPCODE_GAS` | `3` |</code></div>
                    <div class="detail"><strong>Location:</strong> <code>params/protocol_params.go</code></div>
                    <div class="detail"><strong>Impact:</strong> The absence of these fundamental identifiers in a shared parameters file can lead to inconsistent usage across the client, potentially causing failures in transaction identification, hash validation, precompile routing, and opcode execution. This would result in consensus failures.</div>
                    <div class="detail"><strong>Fix:</strong> Define all EIP-4844 specified constants in `params/protocol_params.go` to ensure consistency. This includes adding constants for the blob transaction type, versioned hash prefix, precompile address, and the BLOBHASH opcode value and gas cost.</div>
                </div>

                <div class="issue issue-low">
                    <div class="title">[LOW] DEVIATION</div>
                    <div class="detail"><strong>Description:</strong> The code defines a constant `BlobBaseCost = 1 << 13` (8192). This constant is not mentioned in the EIP-4844 specification. It appears to be an implementation-specific value related to the intrinsic *execution gas* cost of a blob transaction, separate from the *blob gas* market. The EIP does not explicitly detail how the presence of `blob_versioned_hashes` should affect the intrinsic execution gas calculation.</div>
                    <div class="detail"><strong>Spec ref:</strong> <code>The EIP-4844 specification does not define a constant named `BlobBaseCost` or specify an additional intrinsic execution gas cost per blob.</code></div>
                    <div class="detail"><strong>Location:</strong> <code>params/protocol_params.go (line 250)</code></div>
                    <div class="detail"><strong>Impact:</strong> While not a direct violation of an explicit requirement, this introduces a non-specified parameter into the protocol. If different client implementations were to derive this intrinsic cost differently (e.g., by treating versioned hashes as calldata or using a different base cost), it would lead to different transaction validation outcomes and a potential consensus split.</div>
                    <div class="detail"><strong>Fix:</strong> The purpose of `BlobBaseCost` should be clearly documented in the code. For long-term protocol health, the intrinsic gas calculation for blob transactions should be explicitly specified in the EIP or a successor to ensure all clients calculate it identically.</div>
                </div>

            </div>
        </div>

        <div class="file-card">
            <div class="head">
                <span class="path">core/txpool/legacypool/legacypool.go</span>
                <span class="badge" style="background:#dc3545">MISSING</span>
            </div>
            <div class="content">
                <p><strong>Confidence:</strong> 100%</p>
                <p>The provided code from `legacypool.go` does not implement EIP-4844. It is designed as a pool for pre-Cancun transaction types and correctly rejects blob transactions. Therefore, a comparison reveals a complete absence of the EIP-4844 specification within this component.</p>

                <div class="issue issue-high">
                    <div class="title">[HIGH] MISSING_CHECK</div>
                    <div class="detail"><strong>Description:</strong> The provided code, `core/txpool/legacypool/legacypool.go`, is a transaction pool implementation for legacy transaction types and explicitly rejects EIP-4844 blob transactions. The `FilterType` and `ValidateTxBasics` functions only permit transaction types 0 (Legacy), 1 (AccessList), 2 (DynamicFee), and 4 (SetCode), excluding type 3 (Blob). Furthermore, the `Pending` function contains a specific guard clause stating `If only blob transactions are requested, this pool is unsuitable as it contains none`. Consequently, none of the required logic for EIP-4844, including blob transaction validation, blob gas accounting, sidecar handling, and KZG proof verification, is implemented in this file.</div>
                    <div class="detail"><strong>Spec ref:</strong> <code>We introduce a new type of EIP-2718 transaction, "blob transaction", where the `TransactionType` is `BLOB_TX_TYPE`</code></div>
                    <div class="detail"><strong>Location:</strong> <code>FilterType(), ValidateTxBasics(), Pending()</code></div>
                    <div class="detail"><strong>Impact:</strong> If this were the sole transaction pool implementation on a node, the node would be unable to process, validate, or propagate any EIP-4844 transactions after the Cancun hard fork, leading to an inability to follow the canonical chain. In the context of the complete go-ethereum client, this component is designed to operate alongside a separate blob transaction pool (`blobpool`), so its behavior is correct within that architecture. However, it completely fails to implement the EIP-4844 specification as requested by the task.</div>
                    <div class="detail"><strong>Fix:</strong> To perform a compliance review of the EIP-4844 transaction pool implementation in go-ethereum, the code from `core/txpool/blobpool/blobpool.go` should be analyzed instead. The `legacypool` is functioning as designed by rejecting transaction types it is not responsible for.</div>
                </div>

            </div>
        </div>

        <div class="footer">
            PRSpec v1.1.0 &middot; Gemini (gemini-2.5-pro) &middot; EIP-4844 &middot; go-ethereum &middot; 2026-02-14 06:28
        </div>
    </div>
</div>
</body>
</html>
